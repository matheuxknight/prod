<?php

function showJumbotron($title, $id, $url, $icon)
{
	$iconset = param('iconset');
	$icon = "/images/iconset/$iconset/$icon";
	
echo <<<end
<a href="$url">
	<div class="jumbotron" id="$id" style='text-align:center; line-height:179px;'>
		<img src="$icon" style="width:150px; vertical-align:center; margin-top:-38px" />
		<h2 style='text-align:left; font-size:28px'>$title</h2>
	</div>
</a>
end;
}

$user = getUser();
$server = getdbo('Server', 1);

if(param('mysansspacetiles'))
{
	echo <<<end
	<main class="container" style="max-width:970px;">
	<div style="line-height:1em; margin-right;10px; margin-top:-22px; margin-bottom:30px; margin-left:-5px">
	<h3 style='max-width:640px; min-width:400px; max-height:75px; margin-top:32px; margin-left:120px; margin-right:300px; overflow:hidden; position:absolute; color:rgb(0, 122, 187);' class='error h2'><a href='/my/settings' style='color:rgb(0, 122, 187);text-decoration:none'>
end;
	echo $user->firstname;
	echo "<br>";
	echo "$user->secondname ";
	echo "$user->thirdname ";
	echo "$user->fourthname ";
	echo "$user->fifthname ";
	echo "$user->sixthname ";
	echo "</a>";
	echo "</h3>";
	echo "<a href='/my/settings' style='color:rgb(0, 122, 187); text-decoration:none;'>";
	echo userImage($user, 100);
	echo "</a>";
	echo "</div>";

	if(controller()->rbac->globalAdmin())
	{
		echo "<h4 align='right' class='error' style='text-decoration:none; color:rgb(0, 122, 187); line-height:1em; margin-right:5px; text-align:right; margin-top:-83px; z-index:1'><a href='/textbook/addstudentcode' style='text-decoration:none; color:rgb(0, 122, 187)' ><font style='border-bottom:1px blue dotted;'>Enroll in my course</font></a>   <a href='javascript:void(0)' id='popuplink2'><em style='color:#ec4546; font-size:16px; verticle-align:middle' class='fa fa-question-circle'></em></a></h4>";
		echo "<h4 align='right' class='error' style='text-decoration:none; color:rgb(0, 122, 187); line-height:1em; margin-right:5px; text-align:right; margin-bottom:22px; z-index:1'><a href='/textbook/addteachercourse' style='text-decoration:none; color:rgb(0, 122, 187)' ><font style='border-bottom:1px blue dotted;'>Create my course</font></a>   <a href='javascript:void(0)' id='popuplink1'><em style='color:#ec4546; font-size:16px; verticle-align:middle' class='fa fa-question-circle'></em></a></h4>";
	}
	
	else
	{
		if(controller()->rbac->globalStudent())
			echo "<h4 align='right' class='error' style='text-decoration:none; color:rgb(0, 122, 187); line-height:1em; margin-right:5px; text-align:right; margin-top:-50px; margin-bottom:22px; z-index:1'><a href='/textbook/addstudentcode' style='text-decoration:none; color:rgb(0, 122, 187)' ><font style='border-bottom:1px blue dotted;'>Enroll in my course</font></a>   <a href='javascript:void(0)' id='popuplink2'><em style='color:#ec4546; font-size:16px; verticle-align:middle' class='fa fa-question-circle'></em></a></h4>";
		
		if(controller()->rbac->globalTeacher())
			echo "<h4 align='right' class='error' style='text-decoration:none; color:rgb(0, 122, 187); line-height:1em; margin-right:5px; text-align:right; margin-top:-50px; margin-bottom:22px; z-index:1'><a href='/textbook/addteachercourse' style='text-decoration:none; color:rgb(0, 122, 187)' ><font style='border-bottom:1px blue dotted;'>Create my course</font>   <a href='javascript:void(0)' id='popuplink1'><em style='color:#ec4546; font-size:16px; verticle-align:middle' class='fa fa-question-circle'></em></a></a></h4>";
	}
	
	echo "<div class='row'>";
	
	echo "<div class='col-md-7'>";
	$iconset = param('iconset');
	$icon = "/images/iconset/$iconset/mycourses.png";
	
	echo <<<end
	<div class="jumbotron" id="my-courses"><div class="row">
	<a href='/my/courses' style='color:white;'><div class="col-md-3" style="float:left"><img src="$icon" style='width:150px; margin-left:-30px' /></div></a><div style="float:right; font-size: 11pt; margin-top:15px; margin-right:-30px"><ul>
end;
	
	$objects = objectList('mycourses');
	foreach($objects as $n=>$object)
		echo '<li>'.l($object->name, array('object/show', 'id'=>$object->id), array('style'=>'color: white')).'</li>';
	
	echo "</ul></div></div><a href='/my/courses'><h2 style='color:white; font-size:28px'>Courses</h2></a></div></div>";
	
	echo "<div class='col-md-5'>";
	showJumbotron("Grades", "my-reports", "/my/reports", "myreports.png");
	echo "</div>";
	
	echo "</div> <!-- .row -->";
	echo "<div class='row'>";
	
	echo "<div class='col-md-4'>";
	echo <<<end
<a href="/my/folders">
	<div class="jumbotron" id="my-saved-work" style='text-align:center; height:220px; min-height:200px; margin-top:-10px;'>
		<img src="/images/iconset/wayside/myfolders1.png" style="width:150px; vertical-align:center; margin-top:-32px" />
		<h2 style='text-align:left; font-size:28px'>My Work</h2>
	</div>
</a>
end;
	echo "</div>";
	
	echo "<div class='col-md-4'>";
	echo <<<end
<a href="/pm">
	<div class="jumbotron" id="my-inbox" style='text-align:center; height:220px; min-height:200px; margin-top:-10px'>
		<img src="/images/iconset/wayside/myinbox.png" style="width:150px; vertical-align:center; margin-top:-32px" />
		<h2 style='text-align:left; font-size:28px'>Inbox</h2>
	</div>
</a>
end;
	echo "</div>";
	
	echo "<div class='col-md-4'>";
	echo <<<end
<a href="/my/settings">
	<div class="jumbotron" id="settings" style='text-align:center; height:220px; min-height:200px; margin-top:-10px;'>
		<img src="/images/iconset/wayside/mysettings.png" style="width:150px; vertical-align:center; margin-top:-32px" />
		<h2 style='text-align:left; font-size:28px'>Settings</h2>
	</div>
</a>
end;
	echo "</div>";
	
	echo "</div> <!-- .row -->";
	echo "</main>";
}

else
{
	echo "<h2>Welcome {$user->name}</h2>";
	echo "$server->mymessage";

	$commands = RbacCommandMyTable();
	
	echo "<div class='col1'>";
	foreach($commands as $n=>$id)
	{
		$command = getdbo('Command', $id);
		if(!controller()->rbac->globalAccess($command))
			continue;
	
	 	if($n == round(count($commands)/2))
	 		echo "</div><div class='col2'>";
	
		showMyItem($command);
	//	echo "<br>";
	}
	
	echo "</div>";
	echo "<div style='clear:both'></div>";
}

////////////////////////////////////////////////////////////////////

function showMyItem($command)
{
	$user = getUser();
	
	echo "<table cellspacing=0 cellpadding=0 width='100%' class='ssitem'
		style='padding: 6px; '><tr>";
	
	echo "<td width=10>";
	echo "</td>";
	
	echo "<td width=64 valign=top>";
	echo l($command->getImage(48), array($command->url));
	echo "</td>";
	
	if($command->id == SSPACE_COMMAND_MY_INBOX)
	{
		$count = getdbocount('PrivateMessage', "touserid=$user->id and not recv and not draft");
		//PrivateMessage::model()->count("touserid=$user->id and not recv and not draft");
		if($count) $command->name .= " ($count)";
	}
	
	echo "<td id='object_{$object->id}_parent' valign=top>";
	echo l($command->name, array($command->url));
	
	echo "<div class='small'>";
	$objects = null;
	
	switch($command->id)
	{
		case SSPACE_COMMAND_MY_COURSES:
			$objects = objectList('mycourses');
			break;

		case SSPACE_COMMAND_MY_RESOURCES:
			$objects = objectList('mylocations');
			break;

		case SSPACE_COMMAND_MY_FOLDERS:
			$objects = objectList('myfolders');
			break;

		case SSPACE_COMMAND_MY_REPORTS:
			$objects = objectList('mycourses');

			foreach($objects as $n=>$object)
			{
				if($n != 0) echo " &#9679; ";
				echo l(h($object->name), array('studentreport/', 'id'=>$object->id));
			}

			$objects = null;
			break;

		case SSPACE_COMMAND_MY_INBOX:
			echo l("Send a Message", array('pm/create'));

			break;

		case SSPACE_COMMAND_MY_FAVORITES:
			$objects = objectList('myfavorites');
			break;

		case SSPACE_COMMAND_MY_SETTINGS:
			break;
	}

	if($objects) foreach($objects as $n=>$object)
	{
		if($n != 0) echo " &#9679; ";
		echo l($object->name, array('object/show', 'id'=>$object->id));
	}
	echo "</div>";
	
	echo "</td></tr></table>";
}

if(IsMobileDevice())
	echo "<br><br><br><br><br><br><br><br>";

echo <<<end
<script type="text/javascript">
		
$(document).ready(function() 
{
	$('#popup1').dialog({ autoOpen: false, modal: true, width: '620', dialogClass:'modalpopup' })
	$('#popuplink1').click(function(){ $('div#popup1').dialog('open'); });
})
		
$(document).ready(function() 
{
	$('#popup2').dialog({ autoOpen: false, modal: true, width: '620', dialogClass:'modalpopup' })
	$('#popuplink2').click(function(){ $('div#popup2').dialog('open'); });
})
		
</script>
		
<div id="popup1" title="Create my course">
    <p class='error' style='font-size:18px; padding:0px' autofocus></p>
    <p style='font-size:14px; text-align:center'><iframe width=480 height=360 frameborder=0 seamless src='http://learningsite.waysidepublishing.com/file/embed?id=18088'></iframe></p>
</div>
<div id="popup2" title="Enroll in my course">
    <p class='error' style='font-size:18px; padding:0px' autofocus></p>
    <p style='font-size:14px; text-align:center'><iframe width=480 height=360 frameborder=0 seamless src='http://learningsite.waysidepublishing.com/file/embed?id=18089'></iframe></p>
</div>
end;

if(IsMobileEmbeded())
	SetAppHeaderColors();





